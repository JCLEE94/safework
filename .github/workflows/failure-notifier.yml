name: Failure Issue Creator

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-and-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Intentional failure
        id: fail-step
        run: |
          echo "This step will fail"
          exit 1
        continue-on-error: true
      
      - name: Create issue on failure
        if: steps.fail-step.outcome == 'failure'
        uses: actions/github-script@v7
        with:
          script: |
            const issueTitle = `[CI/CD Failure] Test workflow failed`;
            
            try {
              const issue = await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: issueTitle,
                body: `## ðŸš¨ Test Failure\n\nThis is a test of the CI/CD failure tracking system.\n\n**Time:** ${new Date().toISOString()}\n**Workflow:** ${context.workflow}\n**Run:** ${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`,
                labels: ['bug']
              });
              console.log(`Created issue #${issue.data.number}`);
              core.setOutput('issue-number', issue.data.number);
            } catch (error) {
              console.error('Failed to create issue:', error);
              core.setFailed(error.message);
            }