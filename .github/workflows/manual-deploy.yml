# SafeWork Pro - ìˆ˜ë™ íŠ¸ë¦¬ê±° ë°°í¬ íŒŒì´í”„ë¼ì¸
# GitHub Actions ë¹Œë§ ë¬¸ì œ ìš°íšŒë¥¼ ìœ„í•œ ìˆ˜ë™ ì‹¤í–‰ ì›Œí¬í”Œë¡œìš°

name: Manual Deploy

on:
  workflow_dispatch:
    inputs:
      deploy_environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - staging
          - development

env:
  REGISTRY: registry.jclee.me
  IMAGE_NAME: safework

jobs:
  deploy:
    name: Manual Deployment
    runs-on: ubuntu-latest
    if: github.actor == 'JCLEE94'  # íŠ¹ì • ì‚¬ìš©ìë§Œ ì‹¤í–‰ ê°€ëŠ¥
    timeout-minutes: 15
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create minimal frontend
        run: |
          mkdir -p frontend/dist
          echo '<!DOCTYPE html><html><head><title>SafeWork Pro</title></head>' > frontend/dist/index.html
          echo '<body><h1>SafeWork Pro</h1><p>ê±´ì„¤ì—… ë³´ê±´ê´€ë¦¬ ì‹œìŠ¤í…œ</p>' >> frontend/dist/index.html
          echo '<p>Build: ${{ github.run_number }} | Env: ${{ inputs.deploy_environment }}</p>' >> frontend/dist/index.html
          echo '</body></html>' >> frontend/dist/index.html
          
      - name: Build info
        run: |
          echo "## ğŸ”¨ Manual Build" >> $GITHUB_STEP_SUMMARY
          echo "- Environment: ${{ inputs.deploy_environment }}" >> $GITHUB_STEP_SUMMARY
          echo "- Commit: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- Triggered by: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "1. SSH to server" >> $GITHUB_STEP_SUMMARY
          echo "2. Pull latest code" >> $GITHUB_STEP_SUMMARY
          echo "3. Run: \`./scripts/manual-build.sh\`" >> $GITHUB_STEP_SUMMARY
          echo "4. Deploy to K8s or Docker" >> $GITHUB_STEP_SUMMARY